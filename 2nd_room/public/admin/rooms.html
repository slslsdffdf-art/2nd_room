<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Rooms Admin</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@400;600&display=swap" rel="stylesheet">
<style>
  body{margin:0;padding:20px;font-family:'Noto Serif KR',serif;background:#f6f1e7;color:#2b1f14}
  .card{max-width:960px;margin:0 auto;background:#fff;border:1px solid #e1d4c2;border-radius:12px;padding:16px}
  h1{margin:0 0 10px;font-size:20px}
  textarea,input,select,button{font-family:inherit}
  textarea{width:100%;min-height:160px;border:1px solid #cdbda6;border-radius:8px;padding:10px}
  input,select{border:1px solid #cdbda6;border-radius:8px;padding:8px}
  .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin:8px 0}
  button{padding:10px 14px;border:1px solid #cdbda6;border-radius:8px;background:#eee;cursor:pointer}
  pre{white-space:pre-wrap;background:#faf7f2;border:1px solid #e4d7c6;border-radius:8px;padding:10px}
</style>
</head>
<body>
  <div class="card">
    <h1>Rooms Admin</h1>

    <div class="row">
      <label>OWNER_PASSWORD</label>
      <input id="pw" type="password" placeholder="서버에 설정한 비밀번호" style="min-width:280px">
    </div>

    <h2>단건 저장</h2>
    <div class="row">
      <label>step</label><input id="step" type="number" min="0" value="1">
      <button id="btnLoad">불러오기</button>
      <button id="btnSave">저장</button>
    </div>
    <textarea id="roomJson" placeholder='{"bg":"","image":"","story":"당신…","choices":{"L":{"label":"…","correct":true,"deathCause":""},"F":{"label":"…","correct":false,"deathCause":"…"},"R":{"label":"…","correct":false,"deathCause":"…"}}}'></textarea>

    <h2>AI 대량 생성</h2>
    <div class="row">
      <label>from</label><input id="from" type="number" value="10">
      <label>count</label><input id="count" type="number" value="50">
      <label>type</label>
      <select id="type">
        <option value="normal" selected>normal</option>
        <option value="special">special</option>
        <option value="ending">ending</option>
      </select>
      <label><input id="use_tags" type="checkbox"> deathCause를 태그(!mechanism 등)로 생성</label>
    </div>
    <div class="row">
      <label>theme</label><input id="theme" value="폐허, 기계, 거울, 물, 길, 금속, 그림자">
      <label>difficulty</label><input id="difficulty" value="보통">
      <button id="btnBulk">AI 생성→저장</button>
    </div>
    <pre id="out">결과 표시 영역…</pre>
  </div>

<script>
  const $=s=>document.querySelector(s);
  const out=$('#out');
  function auth(){ const p=$('#pw').value.trim(); return {'Authorization': 'Bearer '+p, 'Content-Type':'application/json'}; }

  $('#btnLoad').onclick=async ()=>{
    out.textContent='불러오는 중…';
    const step=parseInt($('#step').value,10);
    try{
      const r=await fetch('/api/rooms?step='+step);
      const d=await r.json();
      if(!r.ok||!d.ok){ out.textContent='에러: '+JSON.stringify(d); return; }
      $('#roomJson').value=JSON.stringify(d.room, null, 2);
      out.textContent='불러오기 완료';
    }catch(e){ out.textContent='실패: '+e; }
  };

  $('#btnSave').onclick=async ()=>{
    out.textContent='저장 중…';
    try{
      const step=parseInt($('#step').value,10);
      const room=JSON.parse($('#roomJson').value);
      const r=await fetch('/api/rooms',{method:'POST',headers:auth(),body:JSON.stringify({step,room})});
      const d=await r.json();
      out.textContent=JSON.stringify(d,null,2);
    }catch(e){ out.textContent='실패: '+e; }
  };

  $('#btnBulk').onclick=async ()=>{
    out.textContent='AI 생성 중…';
    try{
      const from=parseInt($('#from').value,10);
      const count=parseInt($('#count').value,10);
      const theme=$('#theme').value;
      const difficulty=$('#difficulty').value;
      const type=$('#type').value;
      const use_tags=$('#use_tags').checked;
      const r=await fetch('/api/rooms',{method:'POST',headers:auth(),body:JSON.stringify({use_ai:true, bulk:{from,count,theme,difficulty,type,use_tags}})});
      const d=await r.json();
      out.textContent=JSON.stringify(d,null,2);
    }catch(e){ out.textContent='실패: '+e; }
  };
</script>
</body>
</html>