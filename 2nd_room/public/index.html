<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>두 번째 방 — 게이트</title>
  <style>
    body{margin:0;background:#111;color:#eee;font-family:system-ui,apple sd gothic neo,Segoe UI,Roboto,Apple Color Emoji,Noto Color Emoji,sans-serif}
    .wrap{max-width:480px;margin:12vh auto;background:#1c1c1c;border:1px solid #333;border-radius:10px;padding:24px}
    h1{font-size:22px;margin:0 0 12px}
    input,button{width:100%;padding:12px;border-radius:8px;border:1px solid #444;background:#0e0e0e;color:#eee}
    button{margin-top:10px;cursor:pointer}
    .msg{min-height:22px;color:#bbb;margin-top:8px}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>입장 코드</h1>
    <p style="color:#bbb">첫 번째 방을 탈출한 사람이면 코드를 알고 있습니다.</p>
    <input id="code" placeholder="코드 입력" autocomplete="one-time-code" />
    <button id="go">입장</button>
    <div id="msg" class="msg"></div>
  </div>

  <script>
  const goBtn = document.getElementById('go');
  const codeEl = document.getElementById('code');
  const msgEl = document.getElementById('msg');

  goBtn.addEventListener('click', login);
  codeEl.addEventListener('keydown', e => { if(e.key==='Enter') login(); });

  async function login(){
    const code = codeEl.value.trim();
    if(!code){ msgEl.textContent = '코드를 입력하세요.'; return; }
    goBtn.disabled = true; msgEl.textContent = '확인 중...';
    const r = await fetch('/api/login', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({ code }),
      credentials: 'same-origin' // ★ 쿠키 수신
    });
    if(!r.ok){
      msgEl.textContent = '코드가 올바르지 않습니다.';
      goBtn.disabled = false; return;
    }
    location.href = '/play/';
  }
  </script>
</body>
</html>
